-- name: GetDomainsByCountry :many
SELECT * FROM domains 
WHERE country = $1 
ORDER BY risk_score DESC 
LIMIT $2 OFFSET $3;

-- name: UpdateDomainMetadata :one
UPDATE domains 
SET metadata = $2, last_check_at = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP
WHERE domain = $1 
RETURNING *;

-- name: UpdateDomainLastCheck :exec
UPDATE domains 
SET last_check_at = CURRENT_TIMESTAMP, updated_at = CURRENT_TIMESTAMP
WHERE domain = $1;

-- name: GetExpiredDomains :many
SELECT * FROM domains 
WHERE status = 'verified' 
AND expires_at IS NOT NULL 
AND expires_at < CURRENT_TIMESTAMP;

-- name: GetDomainsByCompany :many
SELECT * FROM domains 
WHERE company_name ILIKE $1 
ORDER BY risk_score DESC;

-- name: UpdateDomainCompanyAndCountry :one
UPDATE domains 
SET company_name = $2, country = $3, updated_at = CURRENT_TIMESTAMP
WHERE domain = $1 
RETURNING *;

-- name: UpdateDomainRiskScore :one
UPDATE domains 
SET risk_score = $2, reasons = $3, updated_at = CURRENT_TIMESTAMP
WHERE domain = $1 
RETURNING *;